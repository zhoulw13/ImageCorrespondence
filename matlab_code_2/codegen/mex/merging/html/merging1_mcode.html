<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">sp_set</span>, <span class="var type1" id="S3T3U4">bspline_set</span>, <span class="var type1" id="S4T1U5">ref_set</span>] = merging(<span class="mxinfo" id="T1:U4"><span class="mxinfo" id="T1:U5"><span class="var type1" id="S2T1U8">sp_set</span></span></span>, <span class="var type1" id="S5T6U9">sp_val</span>, <span class="mxinfo" id="T3:U8"><span class="mxinfo" id="T3:U9"><span class="var type1" id="S3T3U10">bspline_set</span></span></span>, <span class="mxinfo" id="T1:U11"><span class="mxinfo" id="T1:U12"><span class="var type1" id="S4T1U11">ref_set</span></span></span>, <span class="var type1" id="S6T4U12">Sp2</span>, <span class="var type1" id="S7T54U13">Ref</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line">coder.inline(<span class="string">'never'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%% initialize adjacency graph</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T5:U16"><span class="var type1" id="S9T5U22">surface_amount</span> = <span class="mxinfo" id="T5:U18">size(<span class="var type1" id="S2T1U25">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T4:U20"><span class="var type1" id="S11T4U29">adjacency_graph</span> = <span class="mxinfo" id="T4:U22">zeros(<span class="var type1" id="S9T5U32">surface_amount</span>, <span class="var type1" id="S9T5U33">surface_amount</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T5:U25">[<span class="var type1" id="S13T5U38">x</span>, <span class="var type1" id="S14T5U39">y</span>] = size(<span class="var type1" id="S6T4U42">Sp2</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T5U45">i</span>=<span class="mxinfo" id="T5:U30">1</span>:<span class="var type1" id="S9T5U48">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T6:U32"><span class="var type1" id="S16T6U51">area_i</span> = <span class="mxinfo" id="T6:U34">find(<span class="mxinfo" id="T8:U35"><span class="var type1" id="S6T4U55">Sp2</span>==<span class="mxinfo" id="T5:U37"><span class="var type1" id="S5T6U57">sp_val</span>(<span class="var type1" id="S15T5U58">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T5:U40"><span class="var type1" id="S18T5U61">size_i</span> = <span class="mxinfo" id="T5:U42">size(<span class="var type1" id="S16T6U64">area_i</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S19T5U68">j</span>=(<span class="mxinfo" id="T5:U45"><span class="var type1" id="S15T5U72">i</span>+<span class="mxinfo" id="T5:U47">1</span></span>):<span class="var type1" id="S9T5U74">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="mxinfo" id="T6:U49"><span class="var type1" id="S20T6U77">area_j</span> = <span class="mxinfo" id="T6:U51">find(<span class="mxinfo" id="T8:U52"><span class="var type1" id="S6T4U81">Sp2</span>==<span class="mxinfo" id="T5:U54"><span class="var type1" id="S5T6U83">sp_val</span>(<span class="var type1" id="S19T5U84">j</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T5:U57"><span class="var type1" id="S21T5U87">size_j</span> = <span class="mxinfo" id="T5:U59">size(<span class="var type1" id="S20T6U90">area_j</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo" id="T4:U61"><span class="var type1" id="S22T4U94">dif</span> = <span class="mxinfo" id="T4:U63">abs(<span class="mxinfo" id="T4:U64"><span class="mxinfo" id="T4:U65">repmat(<span class="var type1" id="S16T6U100">area_i</span>, 1, <span class="var type1" id="S21T5U102">size_j</span>)</span> - <span class="mxinfo" id="T4:U68"><span class="mxinfo" id="T4:U69">repmat(<span class="var type1" id="S20T6U106">area_j</span>, 1, <span class="var type1" id="S18T5U108">size_i</span>)</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T11:U72"><span class="mxinfo" id="T5:U73">sum(<span class="mxinfo" id="T6:U74">find(<span class="mxinfo" id="T8:U75"><span class="mxinfo" id="T8:U76"><span class="var type1" id="S22T4U118">dif</span> == <span class="mxinfo" id="T5:U78">1</span></span> | <span class="mxinfo" id="T8:U79"><span class="var type1" id="S22T4U121">dif</span> == <span class="var type1" id="S13T5U122">x</span></span></span>)</span>)</span> ~= <span class="mxinfo" id="T5:U82">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo" id="T5:U83"><span class="mxinfo" id="T5:U84"><span class="var type1" id="S11T4U127">adjacency_graph</span>(<span class="var type1" id="S15T5U128">i</span>, <span class="var type1" id="S19T5U129">j</span>)</span> = <span class="mxinfo" id="T5:U88">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="comment">%% merge superpixels with similiar bspline</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T6:U89"><span class="var type1" id="S26T6U133">Dt</span> = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T25:U91"><span class="var type1" id="S27T25U138">errors</span> = <span class="mxinfo" id="T25:U93">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T6:U94"><span class="var type1" id="S28T6U143">pairs</span> = <span class="mxinfo" id="T6:U96">find(<span class="mxinfo" id="T8:U97"><span class="var type1" id="S11T4U147">adjacency_graph</span>~=<span class="mxinfo" id="T5:U99">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T11:U100"><span class="mxinfo" id="T5:U101">sum(<span class="var type1" id="S28T6U153">pairs</span>)</span> &gt; <span class="mxinfo" id="T5:U103">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T5:U104"><span class="var type1" id="S9T5U157">surface_amount</span> = <span class="mxinfo" id="T5:U106">size(<span class="var type1" id="S2T1U160">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo" id="T5:U108"><span class="var type1" id="S15T5U164">i</span> = <span class="mxinfo" id="T5:U110">mod(<span class="mxinfo" id="T5:U111"><span class="var type1" id="S28T6U168">pairs</span>(<span class="mxinfo" id="T5:U113">1</span>)</span>, <span class="var type1" id="S9T5U170">surface_amount</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo" id="T5:U115"><span class="var type1" id="S19T5U173">j</span> = <span class="mxinfo" id="T5:U117">ceil(<span class="mxinfo" id="T5:U118"><span class="mxinfo" id="T5:U119"><span class="var type1" id="S28T6U178">pairs</span>(<span class="mxinfo" id="T5:U121">1</span>)</span>/<span class="var type1" id="S9T5U180">surface_amount</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo" id="T2:U123"><span class="var type1" id="S31T2U183">union_ij</span> = <span class="mxinfo" id="T2:U125">[<span class="mxinfo" id="T2:U126"><span class="mxinfo" id="T58:U127"><span class="var type1" id="S2T1U188">sp_set</span>(<span class="var type1" id="S15T5U189">i</span>)</span>.val</span>; <span class="mxinfo" id="T2:U130"><span class="mxinfo" id="T58:U131"><span class="var type1" id="S2T1U194">sp_set</span>(<span class="var type1" id="S19T5U195">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo" id="T2:U134"><span class="var type1" id="S32T2U199">ref_union</span> = <span class="mxinfo" id="T2:U136">[<span class="mxinfo" id="T2:U137"><span class="mxinfo" id="T58:U138"><span class="var type1" id="S4T1U204">ref_set</span>(<span class="var type1" id="S15T5U205">i</span>)</span>.val</span>; <span class="mxinfo" id="T2:U141"><span class="mxinfo" id="T58:U142"><span class="var type1" id="S4T1U210">ref_set</span>(<span class="var type1" id="S19T5U211">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo" id="T50:U145"><span class="var type1" id="S33T50U215">control_p</span> = <span class="mxinfo" id="T50:U147"><span class="fcn" id="F351N3:B217">bspline_inv</span>(<span class="var type1" id="S31T2U218">union_ij</span>, <span class="var type1" id="S32T2U219">ref_union</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo" id="T27:U150"><span class="var type1" id="S35T27U222">bound1</span> = <span class="mxinfo" id="T27:U152">min(<span class="var type1" id="S31T2U225">union_ij</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T27:U154"><span class="var type1" id="S37T27U231">bound2</span> = <span class="mxinfo" id="T27:U156">min(<span class="mxinfo" id="T2:U157"><span class="mxinfo" id="T58:U158"><span class="var type1" id="S2T1U236">sp_set</span>(<span class="var type1" id="S15T5U237">i</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T27:U161"><span class="var type1" id="S38T27U244">bound3</span> = <span class="mxinfo" id="T27:U163">min(<span class="mxinfo" id="T2:U164"><span class="mxinfo" id="T58:U165"><span class="var type1" id="S2T1U249">sp_set</span>(<span class="var type1" id="S19T5U250">j</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T5:U168"><span class="var type1" id="S18T5U257">size_i</span> = <span class="mxinfo" id="T5:U170">size(<span class="mxinfo" id="T2:U171"><span class="mxinfo" id="T58:U172"><span class="var type1" id="S2T1U262">sp_set</span>(<span class="var type1" id="S15T5U263">i</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T52:U175"><span class="var type1" id="S39T52U268">item</span> = <span class="mxinfo" id="T52:U177">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T4:U178"><span class="var type1" id="S33T50U273">control_p</span>(:,:,<span class="mxinfo" id="T5:U180">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T4:U181"><span class="var type1" id="S33T50U279">control_p</span>(:,:,<span class="mxinfo" id="T5:U183">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T2:U184"><span class="var type1" id="S41T2U285">ref_it</span> = (<span class="mxinfo" id="T2:U186"><span class="fcn" id="F368N2:B288">bspline</span>(<span class="mxinfo" id="T2:U187"><span class="mxinfo" id="T58:U188"><span class="var type1" id="S2T1U291">sp_set</span>(<span class="var type1" id="S15T5U292">i</span>)</span>.val</span>, <span class="var type1" id="S39T52U294">item</span>, <span class="var type1" id="S35T27U295">bound1</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T2:U193"><span class="var type1" id="S43T2U298">ref_i</span> = (<span class="mxinfo" id="T2:U195"><span class="fcn" id="F368N2:B301">bspline</span>(<span class="mxinfo" id="T2:U196"><span class="mxinfo" id="T58:U197"><span class="var type1" id="S2T1U304">sp_set</span>(<span class="var type1" id="S15T5U305">i</span>)</span>.val</span>, <span class="mxinfo" id="T52:U200"><span class="var type1" id="S3T3U308">bspline_set</span>(<span class="var type1" id="S15T5U309">i</span>)</span>, <span class="var type1" id="S37T27U310">bound2</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo" id="T6:U204"><span class="mxinfo" id="T6:U205"><span class="var type1" id="S41T2U314">ref_it</span>(<span class="mxinfo" id="T53:U207"><span class="var type1" id="S41T2U316">ref_it</span>&lt;<span class="mxinfo" id="T5:U209">0</span></span>)</span>=<span class="mxinfo" id="T5:U210">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T6:U211"><span class="mxinfo" id="T6:U212"><span class="var type1" id="S41T2U322">ref_it</span>(<span class="mxinfo" id="T53:U214"><span class="var type1" id="S41T2U324">ref_it</span>&gt;<span class="mxinfo" id="T5:U216">1</span></span>)</span>=<span class="mxinfo" id="T5:U217">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo" id="T6:U218"><span class="mxinfo" id="T6:U219"><span class="var type1" id="S43T2U330">ref_i</span>(<span class="mxinfo" id="T53:U221"><span class="var type1" id="S43T2U332">ref_i</span>&lt;<span class="mxinfo" id="T5:U223">0</span></span>)</span>=<span class="mxinfo" id="T5:U224">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo" id="T6:U225"><span class="mxinfo" id="T6:U226"><span class="var type1" id="S43T2U338">ref_i</span>(<span class="mxinfo" id="T53:U228"><span class="var type1" id="S43T2U340">ref_i</span>&gt;<span class="mxinfo" id="T5:U230">1</span></span>)</span>=<span class="mxinfo" id="T5:U231">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo" id="T55:U232"><span class="var type1" id="S44T55U345">val_it</span> = <span class="mxinfo" id="T55:U234"><span class="fcn" id="F377N5:B347">getPixelsValue</span>(<span class="var type1" id="S7T54U348">Ref</span>, <span class="var type1" id="S41T2U349">ref_it</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo" id="T55:U237"><span class="var type1" id="S46T55U352">val_i</span> = <span class="mxinfo" id="T55:U239"><span class="fcn" id="F377N5:B354">getPixelsValue</span>(<span class="var type1" id="S7T54U355">Ref</span>, <span class="var type1" id="S43T2U356">ref_i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo" id="T5:U242"><span class="var type1" id="S21T5U359">size_j</span> = <span class="mxinfo" id="T5:U244">size(<span class="mxinfo" id="T2:U245"><span class="mxinfo" id="T58:U246"><span class="var type1" id="S2T1U364">sp_set</span>(<span class="var type1" id="S19T5U365">j</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">    <span class="mxinfo" id="T2:U249"><span class="var type1" id="S47T2U370">ref_jt</span> = (<span class="mxinfo" id="T2:U251"><span class="fcn" id="F368N2:B373">bspline</span>(<span class="mxinfo" id="T2:U252"><span class="mxinfo" id="T58:U253"><span class="var type1" id="S2T1U376">sp_set</span>(<span class="var type1" id="S19T5U377">j</span>)</span>.val</span>, <span class="var type1" id="S39T52U379">item</span>, <span class="var type1" id="S35T27U380">bound1</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo" id="T2:U258"><span class="var type1" id="S48T2U383">ref_j</span> = (<span class="mxinfo" id="T2:U260"><span class="fcn" id="F368N2:B386">bspline</span>(<span class="mxinfo" id="T2:U261"><span class="mxinfo" id="T58:U262"><span class="var type1" id="S2T1U389">sp_set</span>(<span class="var type1" id="S19T5U390">j</span>)</span>.val</span>, <span class="mxinfo" id="T52:U265"><span class="var type1" id="S3T3U393">bspline_set</span>(<span class="var type1" id="S19T5U394">j</span>)</span>, <span class="var type1" id="S38T27U395">bound3</span>)</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo" id="T6:U269"><span class="mxinfo" id="T6:U270"><span class="var type1" id="S47T2U399">ref_jt</span>(<span class="mxinfo" id="T53:U272"><span class="var type1" id="S47T2U401">ref_jt</span>&lt;<span class="mxinfo" id="T5:U274">0</span></span>)</span>=<span class="mxinfo" id="T5:U275">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo" id="T6:U276"><span class="mxinfo" id="T6:U277"><span class="var type1" id="S47T2U407">ref_jt</span>(<span class="mxinfo" id="T53:U279"><span class="var type1" id="S47T2U409">ref_jt</span>&gt;<span class="mxinfo" id="T5:U281">1</span></span>)</span>=<span class="mxinfo" id="T5:U282">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">    <span class="mxinfo" id="T6:U283"><span class="mxinfo" id="T6:U284"><span class="var type1" id="S48T2U415">ref_j</span>(<span class="mxinfo" id="T53:U286"><span class="var type1" id="S48T2U417">ref_j</span>&lt;<span class="mxinfo" id="T5:U288">0</span></span>)</span>=<span class="mxinfo" id="T5:U289">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo" id="T6:U290"><span class="mxinfo" id="T6:U291"><span class="var type1" id="S48T2U423">ref_j</span>(<span class="mxinfo" id="T53:U293"><span class="var type1" id="S48T2U425">ref_j</span>&gt;<span class="mxinfo" id="T5:U295">1</span></span>)</span>=<span class="mxinfo" id="T5:U296">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">    <span class="mxinfo" id="T55:U297"><span class="var type1" id="S49T55U430">val_jt</span> = <span class="mxinfo" id="T55:U299"><span class="fcn" id="F377N5:B432">getPixelsValue</span>(<span class="var type1" id="S7T54U433">Ref</span>, <span class="var type1" id="S47T2U434">ref_jt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="mxinfo" id="T55:U302"><span class="var type1" id="S50T55U437">val_j</span> = <span class="mxinfo" id="T55:U304"><span class="fcn" id="F377N5:B439">getPixelsValue</span>(<span class="var type1" id="S7T54U440">Ref</span>, <span class="var type1" id="S48T2U441">ref_j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">    <span class="mxinfo" id="T5:U307"><span class="var type1" id="S51T5U444">D_sp1</span> = <span class="mxinfo" id="T5:U309">sum(<span class="mxinfo" id="T56:U310">sum(<span class="mxinfo" id="T55:U311">(<span class="mxinfo" id="T55:U312"><span class="var type1" id="S44T55U452">val_it</span>-<span class="var type1" id="S46T55U453">val_i</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="mxinfo" id="T5:U315"><span class="var type1" id="S52T5U459">D_sp2</span> = <span class="mxinfo" id="T5:U317">sum(<span class="mxinfo" id="T56:U318">sum(<span class="mxinfo" id="T55:U319">(<span class="mxinfo" id="T55:U320"><span class="var type1" id="S49T55U467">val_jt</span>-<span class="var type1" id="S50T55U468">val_j</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo" id="T5:U323"><span class="var type1" id="S53T5U474">D_sp</span> = <span class="mxinfo" id="T5:U325">(<span class="mxinfo" id="T5:U326"><span class="var type1" id="S51T5U478">D_sp1</span>+<span class="var type1" id="S52T5U479">D_sp2</span></span>)/<span class="mxinfo" id="T5:U329">size(<span class="var type1" id="S31T2U482">union_ij</span>, 1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    <span class="mxinfo" id="T6:U331"><span class="var type1" id="S26T6U486">Dt</span> = <span class="mxinfo" id="T6:U333">[<span class="var type1" id="S26T6U489">Dt</span>; <span class="var type1" id="S53T5U491">D_sp</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo" id="T5:U336"><span class="mxinfo" id="T5:U337"><span class="var type1" id="S11T4U495">adjacency_graph</span>(<span class="var type1" id="S15T5U496">i</span>, <span class="var type1" id="S19T5U497">j</span>)</span> = <span class="mxinfo" id="T5:U341">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T11:U342"><span class="var type1" id="S53T5U502">D_sp</span> &lt; <span class="mxinfo" id="T5:U344">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line">        <span class="mxinfo" id="T42:U345"><span class="mxinfo" id="T42:U346"><span class="var type1" id="S11T4U507">adjacency_graph</span>(<span class="var type1" id="S15T5U508">i</span>, <span class="mxinfo" id="T11:U349"><span class="var type1" id="S15T5U510">i</span>:<span class="var type1" id="S19T5U511">j</span></span>)</span> = <span class="mxinfo" id="T42:U352"><span class="mxinfo" id="T42:U353"><span class="var type1" id="S11T4U514">adjacency_graph</span>(<span class="var type1" id="S15T5U515">i</span>, <span class="mxinfo" id="T11:U356"><span class="var type1" id="S15T5U517">i</span>:<span class="var type1" id="S19T5U518">j</span></span>)</span> + <span class="mxinfo" id="T42:U359"><span class="mxinfo" id="T6:U360"><span class="var type1" id="S11T4U521">adjacency_graph</span>(<span class="mxinfo" id="T11:U362"><span class="var type1" id="S15T5U523">i</span>:<span class="var type1" id="S19T5U524">j</span></span>, <span class="var type1" id="S19T5U525">j</span>)</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line">        <span class="mxinfo" id="T6:U366"><span class="mxinfo" id="T6:U367"><span class="var type1" id="S11T4U529">adjacency_graph</span>(<span class="mxinfo" id="T11:U369"><span class="mxinfo" id="T5:U370">1</span>:<span class="var type1" id="S15T5U532">i</span></span>, <span class="var type1" id="S15T5U533">i</span>)</span> = <span class="mxinfo" id="T6:U373"><span class="mxinfo" id="T6:U374"><span class="var type1" id="S11T4U536">adjacency_graph</span>(<span class="mxinfo" id="T11:U376"><span class="mxinfo" id="T5:U377">1</span>:<span class="var type1" id="S15T5U539">i</span></span>, <span class="var type1" id="S15T5U540">i</span>)</span> + <span class="mxinfo" id="T6:U380"><span class="var type1" id="S11T4U542">adjacency_graph</span>(<span class="mxinfo" id="T11:U382"><span class="mxinfo" id="T5:U383">1</span>:<span class="var type1" id="S15T5U545">i</span></span>, <span class="var type1" id="S19T5U546">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line">        <span class="mxinfo" id="T42:U386"><span class="mxinfo" id="T42:U387"><span class="var type1" id="S11T4U550">adjacency_graph</span>(<span class="var type1" id="S15T5U551">i</span>, <span class="mxinfo" id="T11:U390"><span class="var type1" id="S19T5U553">j</span>:<span class="mxinfo" id="T5:U392">end</span></span>)</span> = <span class="mxinfo" id="T42:U393"><span class="mxinfo" id="T42:U394"><span class="var type1" id="S11T4U558">adjacency_graph</span>(<span class="var type1" id="S15T5U559">i</span>, <span class="mxinfo" id="T11:U397"><span class="var type1" id="S19T5U561">j</span>:<span class="mxinfo" id="T5:U399">end</span></span>)</span> + <span class="mxinfo" id="T42:U400"><span class="var type1" id="S11T4U565">adjacency_graph</span>(<span class="var type1" id="S19T5U566">j</span>, <span class="mxinfo" id="T11:U403"><span class="var type1" id="S19T5U568">j</span>:<span class="mxinfo" id="T5:U405">end</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line">        <span class="mxinfo" id="T4:U406"><span class="var type1" id="S11T4U574">adjacency_graph</span>(<span class="var type1" id="S19T5U575">j</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo" id="T4:U409"><span class="var type1" id="S11T4U582">adjacency_graph</span>(:, <span class="var type1" id="S19T5U584">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line">        <span class="mxinfo" id="T2:U412"><span class="mxinfo" id="T2:U413"><span class="mxinfo" id="T58:U414"><span class="var type1" id="S2T1U591">sp_set</span>(<span class="var type1" id="S15T5U592">i</span>)</span>.val</span> = <span class="var type1" id="S31T2U594">union_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line">        <span class="mxinfo" id="T1:U418"><span class="var type1" id="S2T1U598">sp_set</span>(<span class="var type1" id="S19T5U599">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78">78</a></span><span class="line">        <span class="mxinfo" id="T2:U421"><span class="mxinfo" id="T2:U422"><span class="mxinfo" id="T58:U423"><span class="var type1" id="S4T1U606">ref_set</span>(<span class="var type1" id="S15T5U607">i</span>)</span>.val</span> = <span class="var type1" id="S32T2U609">ref_union</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79">79</a></span><span class="line">        <span class="mxinfo" id="T1:U427"><span class="var type1" id="S4T1U613">ref_set</span>(<span class="var type1" id="S19T5U614">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80">80</a></span><span class="line">        <span class="mxinfo" id="T52:U430"><span class="var type1" id="S39T52U619">item</span> = <span class="mxinfo" id="T52:U432">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T4:U433"><span class="var type1" id="S33T50U624">control_p</span>(:,:,<span class="mxinfo" id="T5:U435">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T4:U436"><span class="var type1" id="S33T50U630">control_p</span>(:,:,<span class="mxinfo" id="T5:U438">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81">81</a></span><span class="line">        <span class="mxinfo" id="T52:U439"><span class="mxinfo" id="T52:U440"><span class="var type1" id="S3T3U637">bspline_set</span>(<span class="var type1" id="S15T5U638">i</span>)</span> = <span class="var type1" id="S39T52U639">item</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82">82</a></span><span class="line">        <span class="mxinfo" id="T3:U444"><span class="var type1" id="S3T3U643">bspline_set</span>(<span class="var type1" id="S19T5U644">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83">83</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84">84</a></span><span class="line">    <span class="mxinfo" id="T6:U447"><span class="var type1" id="S28T6U649">pairs</span> = <span class="mxinfo" id="T6:U449">find(<span class="mxinfo" id="T8:U450"><span class="var type1" id="S11T4U653">adjacency_graph</span>~=<span class="mxinfo" id="T5:U452">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85">85</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86">86</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87">87</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
