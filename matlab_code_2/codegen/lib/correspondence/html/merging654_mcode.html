<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="125,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">sp_set</span>, <span class="var type1" id="S3T1U4">bspline_set</span>, <span class="var type1" id="S4T63U5">ref_set</span>] = merging(<span class="mxinfo" id="T3:U4"><span class="mxinfo" id="T3:U5"><span class="var type1" id="S2T3U8">sp_set</span></span></span>, <span class="var type1" id="S5T30U9">sp_val</span>, <span class="mxinfo" id="T1:U8"><span class="mxinfo" id="T1:U9"><span class="var type1" id="S3T1U10">bspline_set</span></span></span>, <span class="mxinfo" id="T63:U11"><span class="mxinfo" id="T63:U12"><span class="var type1" id="S4T63U11">ref_set</span></span></span>, <span class="var type1" id="S6T2U12">Sp2</span>, <span class="var type1" id="S7T57U13">Ref</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="125,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,3" id="srcline3"> 3</a></span><span class="line">coder.inline(<span class="string">'never'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="125,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="125,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%% initialize adjacency graph</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T5:U16"><span class="var type1" id="S9T5U22">surface_amount</span> = <span class="mxinfo" id="T5:U18">size(<span class="var type1" id="S2T3U25">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S11T2U29">adjacency_graph</span> = <span class="mxinfo" id="T2:U22">zeros(<span class="var type1" id="S9T5U32">surface_amount</span>, <span class="var type1" id="S9T5U33">surface_amount</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="125,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T5:U25">[<span class="var type1" id="S13T5U38">x</span>, <span class="var type1" id="S14T5U39">y</span>] = size(<span class="var type1" id="S6T2U42">Sp2</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="125,11" id="srcline11">11</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T5U45">i</span>=<span class="mxinfo" id="T5:U30">1</span>:<span class="var type1" id="S9T5U48">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T30:U32"><span class="var type1" id="S16T30U51">area_i</span> = <span class="mxinfo" id="T30:U34">find(<span class="mxinfo" id="T64:U35"><span class="var type1" id="S6T2U55">Sp2</span>==<span class="mxinfo" id="T5:U37"><span class="var type1" id="S5T30U57">sp_val</span>(<span class="var type1" id="S15T5U58">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T5:U40"><span class="var type1" id="S18T5U61">size_i</span> = <span class="mxinfo" id="T5:U42">size(<span class="var type1" id="S16T30U64">area_i</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S19T5U68">j</span>=(<span class="mxinfo" id="T5:U45"><span class="var type1" id="S15T5U72">i</span>+<span class="mxinfo" id="T5:U47">1</span></span>):<span class="var type1" id="S9T5U74">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,15" id="srcline15">15</a></span><span class="line">        <span class="mxinfo" id="T30:U49"><span class="var type1" id="S20T30U77">area_j</span> = <span class="mxinfo" id="T30:U51">find(<span class="mxinfo" id="T64:U52"><span class="var type1" id="S6T2U81">Sp2</span>==<span class="mxinfo" id="T5:U54"><span class="var type1" id="S5T30U83">sp_val</span>(<span class="var type1" id="S19T5U84">j</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T5:U57"><span class="var type1" id="S21T5U87">size_j</span> = <span class="mxinfo" id="T5:U59">size(<span class="var type1" id="S20T30U90">area_j</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo" id="T2:U61"><span class="var type1" id="S22T2U94">dif</span> = <span class="mxinfo" id="T2:U63">abs(<span class="mxinfo" id="T2:U64"><span class="mxinfo" id="T2:U65">repmat(<span class="var type1" id="S16T30U100">area_i</span>, 1, <span class="var type1" id="S21T5U102">size_j</span>)</span> - <span class="mxinfo" id="T2:U68"><span class="mxinfo" id="T2:U69">repmat(<span class="var type1" id="S20T30U106">area_j</span>, 1, <span class="var type1" id="S18T5U108">size_i</span>)</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T6:U72"><span class="mxinfo" id="T5:U73">sum(<span class="mxinfo" id="T30:U74">find(<span class="mxinfo" id="T64:U75"><span class="mxinfo" id="T64:U76"><span class="var type1" id="S22T2U118">dif</span> == <span class="mxinfo" id="T5:U78">1</span></span> | <span class="mxinfo" id="T64:U79"><span class="var type1" id="S22T2U121">dif</span> == <span class="var type1" id="S13T5U122">x</span></span></span>)</span>)</span> ~= <span class="mxinfo" id="T5:U82">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="125,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo" id="T5:U83"><span class="mxinfo" id="T5:U84"><span class="var type1" id="S11T2U127">adjacency_graph</span>(<span class="var type1" id="S15T5U128">i</span>, <span class="var type1" id="S19T5U129">j</span>)</span> = <span class="mxinfo" id="T5:U88">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="125,24" id="srcline24">24</a></span><span class="line"><span class="comment">%% merge superpixels with similiar bspline</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T30:U89"><span class="var type1" id="S26T30U133">Dt</span> = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T49:U91"><span class="var type1" id="S27T49U138">errors</span> = <span class="mxinfo" id="T49:U93">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T30:U94"><span class="var type1" id="S28T30U143">pairs</span> = <span class="mxinfo" id="T30:U96">find(<span class="mxinfo" id="T64:U97"><span class="var type1" id="S11T2U147">adjacency_graph</span>~=<span class="mxinfo" id="T5:U99">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,28" id="srcline28">28</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T6:U100"><span class="mxinfo" id="T5:U101">sum(<span class="var type1" id="S28T30U153">pairs</span>)</span> &gt; <span class="mxinfo" id="T5:U103">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="125,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T5:U104"><span class="var type1" id="S9T5U157">surface_amount</span> = <span class="mxinfo" id="T5:U106">size(<span class="var type1" id="S2T3U160">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo" id="T5:U108"><span class="var type1" id="S15T5U164">i</span> = <span class="mxinfo" id="T5:U110">mod(<span class="mxinfo" id="T5:U111"><span class="var type1" id="S28T30U168">pairs</span>(<span class="mxinfo" id="T5:U113">1</span>)</span>, <span class="var type1" id="S9T5U170">surface_amount</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo" id="T5:U115"><span class="var type1" id="S19T5U173">j</span> = <span class="mxinfo" id="T5:U117">ceil(<span class="mxinfo" id="T5:U118"><span class="mxinfo" id="T5:U119"><span class="var type1" id="S28T30U178">pairs</span>(<span class="mxinfo" id="T5:U121">1</span>)</span>/<span class="var type1" id="S9T5U180">surface_amount</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo" id="T4:U123"><span class="var type1" id="S31T4U183">union_ij</span> = <span class="mxinfo" id="T4:U125">[<span class="mxinfo" id="T4:U126"><span class="mxinfo" id="T74:U127"><span class="var type1" id="S2T3U188">sp_set</span>(<span class="var type1" id="S15T5U189">i</span>)</span>.val</span>; <span class="mxinfo" id="T4:U130"><span class="mxinfo" id="T74:U131"><span class="var type1" id="S2T3U194">sp_set</span>(<span class="var type1" id="S19T5U195">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo" id="T2:U134"><span class="var type1" id="S32T2U199">ref_union</span> = <span class="mxinfo" id="T2:U136">[<span class="mxinfo" id="T2:U137"><span class="mxinfo" id="T109:U138"><span class="var type1" id="S4T63U204">ref_set</span>(<span class="var type1" id="S15T5U205">i</span>)</span>.val</span>; <span class="mxinfo" id="T2:U141"><span class="mxinfo" id="T109:U142"><span class="var type1" id="S4T63U210">ref_set</span>(<span class="var type1" id="S19T5U211">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo" id="T62:U145"><span class="var type1" id="S33T62U215">control_p</span> = <span class="mxinfo" id="T62:U147"><span class="fcn" id="F668N3:B217">bspline_inv</span>(<span class="var type1" id="S31T4U218">union_ij</span>, <span class="var type1" id="S32T2U219">ref_union</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,35" id="srcline35">35</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo" id="T25:U150"><span class="var type1" id="S35T25U222">bound1</span> = <span class="mxinfo" id="T25:U152">min(<span class="var type1" id="S31T4U225">union_ij</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T25:U154"><span class="var type1" id="S37T25U231">bound2</span> = <span class="mxinfo" id="T25:U156">min(<span class="mxinfo" id="T4:U157"><span class="mxinfo" id="T74:U158"><span class="var type1" id="S2T3U236">sp_set</span>(<span class="var type1" id="S15T5U237">i</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T25:U161"><span class="var type1" id="S38T25U244">bound3</span> = <span class="mxinfo" id="T25:U163">min(<span class="mxinfo" id="T4:U164"><span class="mxinfo" id="T74:U165"><span class="var type1" id="S2T3U249">sp_set</span>(<span class="var type1" id="S19T5U250">j</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,39" id="srcline39">39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T5:U168"><span class="var type1" id="S18T5U257">size_i</span> = <span class="mxinfo" id="T5:U170">size(<span class="mxinfo" id="T4:U171"><span class="mxinfo" id="T74:U172"><span class="var type1" id="S2T3U262">sp_set</span>(<span class="var type1" id="S15T5U263">i</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T28:U175"><span class="var type1" id="S39T28U268">item</span> = <span class="mxinfo" id="T28:U177">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T2:U178"><span class="var type1" id="S33T62U273">control_p</span>(:,:,<span class="mxinfo" id="T5:U180">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T2:U181"><span class="var type1" id="S33T62U279">control_p</span>(:,:,<span class="mxinfo" id="T5:U183">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T70:U184"><span class="var type1" id="S41T70U285">ref_it</span> = <span class="mxinfo" id="T70:U186">int32(<span class="mxinfo" id="T4:U187"><span class="fcn" id="F184N2:B289">bspline</span>(<span class="mxinfo" id="T4:U188"><span class="mxinfo" id="T74:U189"><span class="var type1" id="S2T3U292">sp_set</span>(<span class="var type1" id="S15T5U293">i</span>)</span>.val</span>, <span class="var type1" id="S39T28U295">item</span>, <span class="var type1" id="S35T25U296">bound1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T70:U194"><span class="var type1" id="S44T70U299">ref_i</span> = <span class="mxinfo" id="T70:U196">int32(<span class="mxinfo" id="T4:U197"><span class="fcn" id="F184N2:B303">bspline</span>(<span class="mxinfo" id="T4:U198"><span class="mxinfo" id="T74:U199"><span class="var type1" id="S2T3U306">sp_set</span>(<span class="var type1" id="S15T5U307">i</span>)</span>.val</span>, <span class="mxinfo" id="T28:U202"><span class="var type1" id="S3T1U310">bspline_set</span>(<span class="var type1" id="S15T5U311">i</span>)</span>, <span class="var type1" id="S37T25U312">bound2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo" id="T110:U206"><span class="mxinfo" id="T110:U207"><span class="var type1" id="S41T70U316">ref_it</span>(<span class="mxinfo" id="T71:U209"><span class="var type1" id="S41T70U318">ref_it</span>&lt;<span class="mxinfo" id="T5:U211">1</span></span>)</span>=<span class="mxinfo" id="T5:U212">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T110:U213"><span class="mxinfo" id="T110:U214"><span class="var type1" id="S41T70U324">ref_it</span>(<span class="mxinfo" id="T48:U216"><span class="mxinfo" id="T110:U217"><span class="var type1" id="S41T70U327">ref_it</span>(:, <span class="mxinfo" id="T5:U219">1</span>)</span>&gt;<span class="var type1" id="S13T5U330">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U332">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo" id="T110:U222"><span class="mxinfo" id="T110:U223"><span class="var type1" id="S41T70U336">ref_it</span>(<span class="mxinfo" id="T48:U225"><span class="mxinfo" id="T110:U226"><span class="var type1" id="S41T70U339">ref_it</span>(:, <span class="mxinfo" id="T5:U228">2</span>)</span>&gt;<span class="var type1" id="S14T5U342">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U344">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo" id="T110:U231"><span class="mxinfo" id="T110:U232"><span class="var type1" id="S44T70U348">ref_i</span>(<span class="mxinfo" id="T71:U234"><span class="var type1" id="S44T70U350">ref_i</span>&lt;<span class="mxinfo" id="T5:U236">1</span></span>)</span>=<span class="mxinfo" id="T5:U237">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo" id="T110:U238"><span class="mxinfo" id="T110:U239"><span class="var type1" id="S44T70U356">ref_i</span>(<span class="mxinfo" id="T48:U241"><span class="mxinfo" id="T110:U242"><span class="var type1" id="S44T70U359">ref_i</span>(:, <span class="mxinfo" id="T5:U244">1</span>)</span>&gt;<span class="var type1" id="S13T5U362">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U364">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo" id="T110:U247"><span class="mxinfo" id="T110:U248"><span class="var type1" id="S44T70U368">ref_i</span>(<span class="mxinfo" id="T48:U250"><span class="mxinfo" id="T110:U251"><span class="var type1" id="S44T70U371">ref_i</span>(:, <span class="mxinfo" id="T5:U253">2</span>)</span>&gt;<span class="var type1" id="S14T5U374">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U376">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,51" id="srcline51">51</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,52" id="srcline52">52</a></span><span class="line">    <span class="mxinfo" id="T72:U256"><span class="var type1" id="S45T72U379">val_it</span> = <span class="mxinfo" id="T72:U258"><span class="fcn" id="F676N8:B381">getPixelsValue</span>(<span class="var type1" id="S7T57U382">Ref</span>, <span class="var type1" id="S41T70U383">ref_it</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo" id="T72:U261"><span class="var type1" id="S47T72U386">val_i</span> = <span class="mxinfo" id="T72:U263"><span class="fcn" id="F676N8:B388">getPixelsValue</span>(<span class="var type1" id="S7T57U389">Ref</span>, <span class="var type1" id="S44T70U390">ref_i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,54" id="srcline54">54</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo" id="T5:U266"><span class="var type1" id="S21T5U393">size_j</span> = <span class="mxinfo" id="T5:U268">size(<span class="mxinfo" id="T4:U269"><span class="mxinfo" id="T74:U270"><span class="var type1" id="S2T3U398">sp_set</span>(<span class="var type1" id="S19T5U399">j</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo" id="T70:U273"><span class="var type1" id="S48T70U404">ref_jt</span> = <span class="mxinfo" id="T70:U275">int32(<span class="mxinfo" id="T4:U276"><span class="fcn" id="F184N2:B408">bspline</span>(<span class="mxinfo" id="T4:U277"><span class="mxinfo" id="T74:U278"><span class="var type1" id="S2T3U411">sp_set</span>(<span class="var type1" id="S19T5U412">j</span>)</span>.val</span>, <span class="var type1" id="S39T28U414">item</span>, <span class="var type1" id="S35T25U415">bound1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo" id="T70:U283"><span class="var type1" id="S49T70U418">ref_j</span> = <span class="mxinfo" id="T70:U285">int32(<span class="mxinfo" id="T4:U286"><span class="fcn" id="F184N2:B422">bspline</span>(<span class="mxinfo" id="T4:U287"><span class="mxinfo" id="T74:U288"><span class="var type1" id="S2T3U425">sp_set</span>(<span class="var type1" id="S19T5U426">j</span>)</span>.val</span>, <span class="mxinfo" id="T28:U291"><span class="var type1" id="S3T1U429">bspline_set</span>(<span class="var type1" id="S19T5U430">j</span>)</span>, <span class="var type1" id="S38T25U431">bound3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,58" id="srcline58">58</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,59" id="srcline59">59</a></span><span class="line">    <span class="mxinfo" id="T110:U295"><span class="mxinfo" id="T110:U296"><span class="var type1" id="S48T70U435">ref_jt</span>(<span class="mxinfo" id="T71:U298"><span class="var type1" id="S48T70U437">ref_jt</span>&lt;<span class="mxinfo" id="T5:U300">1</span></span>)</span>=<span class="mxinfo" id="T5:U301">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo" id="T110:U302"><span class="mxinfo" id="T110:U303"><span class="var type1" id="S48T70U443">ref_jt</span>(<span class="mxinfo" id="T48:U305"><span class="mxinfo" id="T110:U306"><span class="var type1" id="S48T70U446">ref_jt</span>(:, <span class="mxinfo" id="T5:U308">1</span>)</span>&gt;<span class="var type1" id="S13T5U449">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U451">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,61" id="srcline61">61</a></span><span class="line">    <span class="mxinfo" id="T110:U311"><span class="mxinfo" id="T110:U312"><span class="var type1" id="S48T70U455">ref_jt</span>(<span class="mxinfo" id="T48:U314"><span class="mxinfo" id="T110:U315"><span class="var type1" id="S48T70U458">ref_jt</span>(:, <span class="mxinfo" id="T5:U317">2</span>)</span>&gt;<span class="var type1" id="S14T5U461">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U463">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,62" id="srcline62">62</a></span><span class="line">    <span class="mxinfo" id="T110:U320"><span class="mxinfo" id="T110:U321"><span class="var type1" id="S49T70U467">ref_j</span>(<span class="mxinfo" id="T71:U323"><span class="var type1" id="S49T70U469">ref_j</span>&lt;<span class="mxinfo" id="T5:U325">1</span></span>)</span>=<span class="mxinfo" id="T5:U326">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,63" id="srcline63">63</a></span><span class="line">    <span class="mxinfo" id="T110:U327"><span class="mxinfo" id="T110:U328"><span class="var type1" id="S49T70U475">ref_j</span>(<span class="mxinfo" id="T48:U330"><span class="mxinfo" id="T110:U331"><span class="var type1" id="S49T70U478">ref_j</span>(:, <span class="mxinfo" id="T5:U333">1</span>)</span>&gt;<span class="var type1" id="S13T5U481">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U483">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,64" id="srcline64">64</a></span><span class="line">    <span class="mxinfo" id="T110:U336"><span class="mxinfo" id="T110:U337"><span class="var type1" id="S49T70U487">ref_j</span>(<span class="mxinfo" id="T48:U339"><span class="mxinfo" id="T110:U340"><span class="var type1" id="S49T70U490">ref_j</span>(:, <span class="mxinfo" id="T5:U342">2</span>)</span>&gt;<span class="var type1" id="S14T5U493">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U495">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,65" id="srcline65">65</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,66" id="srcline66">66</a></span><span class="line">    <span class="mxinfo" id="T72:U345"><span class="var type1" id="S50T72U498">val_jt</span> = <span class="mxinfo" id="T72:U347"><span class="fcn" id="F676N8:B500">getPixelsValue</span>(<span class="var type1" id="S7T57U501">Ref</span>, <span class="var type1" id="S48T70U502">ref_jt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo" id="T72:U350"><span class="var type1" id="S51T72U505">val_j</span> = <span class="mxinfo" id="T72:U352"><span class="fcn" id="F676N8:B507">getPixelsValue</span>(<span class="var type1" id="S7T57U508">Ref</span>, <span class="var type1" id="S49T70U509">ref_j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,68" id="srcline68">68</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="125,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo" id="T5:U355"><span class="var type1" id="S52T5U512">D_sp1</span> = <span class="mxinfo" id="T5:U357">sum(<span class="mxinfo" id="T60:U358">sum(<span class="mxinfo" id="T72:U359">(<span class="mxinfo" id="T72:U360"><span class="var type1" id="S45T72U520">val_it</span>-<span class="var type1" id="S47T72U521">val_i</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,70" id="srcline70">70</a></span><span class="line">    <span class="mxinfo" id="T5:U363"><span class="var type1" id="S53T5U527">D_sp2</span> = <span class="mxinfo" id="T5:U365">sum(<span class="mxinfo" id="T60:U366">sum(<span class="mxinfo" id="T72:U367">(<span class="mxinfo" id="T72:U368"><span class="var type1" id="S50T72U535">val_jt</span>-<span class="var type1" id="S51T72U536">val_j</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,71" id="srcline71">71</a></span><span class="line">    <span class="mxinfo" id="T5:U371"><span class="var type1" id="S54T5U542">D_sp</span> = <span class="mxinfo" id="T5:U373">(<span class="mxinfo" id="T5:U374"><span class="var type1" id="S52T5U546">D_sp1</span>+<span class="var type1" id="S53T5U547">D_sp2</span></span>)/<span class="mxinfo" id="T5:U377">size(<span class="var type1" id="S31T4U550">union_ij</span>, 1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,72" id="srcline72">72</a></span><span class="line">    <span class="mxinfo" id="T30:U379"><span class="var type1" id="S26T30U554">Dt</span> = <span class="mxinfo" id="T30:U381">[<span class="var type1" id="S26T30U557">Dt</span>; <span class="var type1" id="S54T5U559">D_sp</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,73" id="srcline73">73</a></span><span class="line">    <span class="mxinfo" id="T5:U384"><span class="mxinfo" id="T5:U385"><span class="var type1" id="S11T2U563">adjacency_graph</span>(<span class="var type1" id="S15T5U564">i</span>, <span class="var type1" id="S19T5U565">j</span>)</span> = <span class="mxinfo" id="T5:U389">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,74" id="srcline74">74</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T6:U390"><span class="var type1" id="S54T5U570">D_sp</span> &lt; <span class="mxinfo" id="T5:U392">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="125,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo" id="T35:U393"><span class="mxinfo" id="T35:U394"><span class="var type1" id="S11T2U575">adjacency_graph</span>(<span class="var type1" id="S15T5U576">i</span>, <span class="mxinfo" id="T6:U397"><span class="var type1" id="S15T5U578">i</span>:<span class="var type1" id="S19T5U579">j</span></span>)</span> = <span class="mxinfo" id="T35:U400"><span class="mxinfo" id="T35:U401"><span class="var type1" id="S11T2U582">adjacency_graph</span>(<span class="var type1" id="S15T5U583">i</span>, <span class="mxinfo" id="T6:U404"><span class="var type1" id="S15T5U585">i</span>:<span class="var type1" id="S19T5U586">j</span></span>)</span> + <span class="mxinfo" id="T35:U407"><span class="mxinfo" id="T30:U408"><span class="var type1" id="S11T2U589">adjacency_graph</span>(<span class="mxinfo" id="T6:U410"><span class="var type1" id="S15T5U591">i</span>:<span class="var type1" id="S19T5U592">j</span></span>, <span class="var type1" id="S19T5U593">j</span>)</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,76" id="srcline76">76</a></span><span class="line">        <span class="mxinfo" id="T30:U414"><span class="mxinfo" id="T30:U415"><span class="var type1" id="S11T2U597">adjacency_graph</span>(<span class="mxinfo" id="T6:U417"><span class="mxinfo" id="T5:U418">1</span>:<span class="var type1" id="S15T5U600">i</span></span>, <span class="var type1" id="S15T5U601">i</span>)</span> = <span class="mxinfo" id="T30:U421"><span class="mxinfo" id="T30:U422"><span class="var type1" id="S11T2U604">adjacency_graph</span>(<span class="mxinfo" id="T6:U424"><span class="mxinfo" id="T5:U425">1</span>:<span class="var type1" id="S15T5U607">i</span></span>, <span class="var type1" id="S15T5U608">i</span>)</span> + <span class="mxinfo" id="T30:U428"><span class="var type1" id="S11T2U610">adjacency_graph</span>(<span class="mxinfo" id="T6:U430"><span class="mxinfo" id="T5:U431">1</span>:<span class="var type1" id="S15T5U613">i</span></span>, <span class="var type1" id="S19T5U614">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,77" id="srcline77">77</a></span><span class="line">        <span class="mxinfo" id="T35:U434"><span class="mxinfo" id="T35:U435"><span class="var type1" id="S11T2U618">adjacency_graph</span>(<span class="var type1" id="S15T5U619">i</span>, <span class="mxinfo" id="T6:U438"><span class="var type1" id="S19T5U621">j</span>:<span class="mxinfo" id="T5:U440">end</span></span>)</span> = <span class="mxinfo" id="T35:U441"><span class="mxinfo" id="T35:U442"><span class="var type1" id="S11T2U626">adjacency_graph</span>(<span class="var type1" id="S15T5U627">i</span>, <span class="mxinfo" id="T6:U445"><span class="var type1" id="S19T5U629">j</span>:<span class="mxinfo" id="T5:U447">end</span></span>)</span> + <span class="mxinfo" id="T35:U448"><span class="var type1" id="S11T2U633">adjacency_graph</span>(<span class="var type1" id="S19T5U634">j</span>, <span class="mxinfo" id="T6:U451"><span class="var type1" id="S19T5U636">j</span>:<span class="mxinfo" id="T5:U453">end</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,78" id="srcline78">78</a></span><span class="line">        <span class="mxinfo" id="T2:U454"><span class="var type1" id="S11T2U642">adjacency_graph</span>(<span class="var type1" id="S19T5U643">j</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,79" id="srcline79">79</a></span><span class="line">        <span class="mxinfo" id="T2:U457"><span class="var type1" id="S11T2U650">adjacency_graph</span>(:, <span class="var type1" id="S19T5U652">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,80" id="srcline80">80</a></span><span class="line">        <span class="mxinfo" id="T4:U460"><span class="mxinfo" id="T4:U461"><span class="mxinfo" id="T74:U462"><span class="var type1" id="S2T3U659">sp_set</span>(<span class="var type1" id="S15T5U660">i</span>)</span>.val</span> = <span class="var type1" id="S31T4U662">union_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,81" id="srcline81">81</a></span><span class="line">        <span class="mxinfo" id="T3:U466"><span class="var type1" id="S2T3U666">sp_set</span>(<span class="var type1" id="S19T5U667">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,82" id="srcline82">82</a></span><span class="line">        <span class="mxinfo" id="T2:U469"><span class="mxinfo" id="T2:U470"><span class="mxinfo" id="T109:U471"><span class="var type1" id="S4T63U674">ref_set</span>(<span class="var type1" id="S15T5U675">i</span>)</span>.val</span> = <span class="var type1" id="S32T2U677">ref_union</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,83" id="srcline83">83</a></span><span class="line">        <span class="mxinfo" id="T63:U475"><span class="var type1" id="S4T63U681">ref_set</span>(<span class="var type1" id="S19T5U682">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,84" id="srcline84">84</a></span><span class="line">        <span class="mxinfo" id="T28:U478"><span class="var type1" id="S39T28U687">item</span> = <span class="mxinfo" id="T28:U480">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T2:U481"><span class="var type1" id="S33T62U692">control_p</span>(:,:,<span class="mxinfo" id="T5:U483">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T2:U484"><span class="var type1" id="S33T62U698">control_p</span>(:,:,<span class="mxinfo" id="T5:U486">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,85" id="srcline85">85</a></span><span class="line">        <span class="mxinfo" id="T28:U487"><span class="mxinfo" id="T28:U488"><span class="var type1" id="S3T1U705">bspline_set</span>(<span class="var type1" id="S15T5U706">i</span>)</span> = <span class="var type1" id="S39T28U707">item</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,86" id="srcline86">86</a></span><span class="line">        <span class="mxinfo" id="T1:U492"><span class="var type1" id="S3T1U711">bspline_set</span>(<span class="var type1" id="S19T5U712">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,87" id="srcline87">87</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,88" id="srcline88">88</a></span><span class="line">    <span class="mxinfo" id="T30:U495"><span class="var type1" id="S28T30U717">pairs</span> = <span class="mxinfo" id="T30:U497">find(<span class="mxinfo" id="T64:U498"><span class="var type1" id="S11T2U721">adjacency_graph</span>~=<span class="mxinfo" id="T5:U500">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="125,89" id="srcline89">89</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="125,90" id="srcline90">90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="125,91" id="srcline91">91</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
