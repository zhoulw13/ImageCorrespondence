<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">sp_set</span>, <span class="var type1" id="S3T3U4">bspline_set</span>, <span class="var type1" id="S4T1U5">ref_set</span>] = merging(<span class="mxinfo" id="T1:U4"><span class="mxinfo" id="T1:U5"><span class="var type1" id="S2T1U8">sp_set</span></span></span>, <span class="var type1" id="S5T6U9">sp_val</span>, <span class="mxinfo" id="T3:U8"><span class="mxinfo" id="T3:U9"><span class="var type1" id="S3T3U10">bspline_set</span></span></span>, <span class="mxinfo" id="T1:U11"><span class="mxinfo" id="T1:U12"><span class="var type1" id="S4T1U11">ref_set</span></span></span>, <span class="var type1" id="S6T4U12">Sp2</span>, <span class="var type1" id="S7T55U13">Ref</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line">coder.inline(<span class="string">'never'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%% initialize adjacency graph</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="mxinfo" id="T5:U16"><span class="var type1" id="S9T5U22">surface_amount</span> = <span class="mxinfo" id="T5:U18">size(<span class="var type1" id="S2T1U25">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T4:U20"><span class="var type1" id="S11T4U29">adjacency_graph</span> = <span class="mxinfo" id="T4:U22">zeros(<span class="var type1" id="S9T5U32">surface_amount</span>, <span class="var type1" id="S9T5U33">surface_amount</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T5:U25">[<span class="var type1" id="S13T5U38">x</span>, <span class="var type1" id="S14T5U39">y</span>] = size(<span class="var type1" id="S6T4U42">Sp2</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T5U45">i</span>=<span class="mxinfo" id="T5:U30">1</span>:<span class="var type1" id="S9T5U48">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T6:U32"><span class="var type1" id="S16T6U51">area_i</span> = <span class="mxinfo" id="T6:U34">find(<span class="mxinfo" id="T8:U35"><span class="var type1" id="S6T4U55">Sp2</span>==<span class="mxinfo" id="T5:U37"><span class="var type1" id="S5T6U57">sp_val</span>(<span class="var type1" id="S15T5U58">i</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo" id="T5:U40"><span class="var type1" id="S18T5U61">size_i</span> = <span class="mxinfo" id="T5:U42">size(<span class="var type1" id="S16T6U64">area_i</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S19T5U68">j</span>=(<span class="mxinfo" id="T5:U45"><span class="var type1" id="S15T5U72">i</span>+<span class="mxinfo" id="T5:U47">1</span></span>):<span class="var type1" id="S9T5U74">surface_amount</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">        <span class="mxinfo" id="T6:U49"><span class="var type1" id="S20T6U77">area_j</span> = <span class="mxinfo" id="T6:U51">find(<span class="mxinfo" id="T8:U52"><span class="var type1" id="S6T4U81">Sp2</span>==<span class="mxinfo" id="T5:U54"><span class="var type1" id="S5T6U83">sp_val</span>(<span class="var type1" id="S19T5U84">j</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo" id="T5:U57"><span class="var type1" id="S21T5U87">size_j</span> = <span class="mxinfo" id="T5:U59">size(<span class="var type1" id="S20T6U90">area_j</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo" id="T4:U61"><span class="var type1" id="S22T4U94">dif</span> = <span class="mxinfo" id="T4:U63">abs(<span class="mxinfo" id="T4:U64"><span class="mxinfo" id="T4:U65">repmat(<span class="var type1" id="S16T6U100">area_i</span>, 1, <span class="var type1" id="S21T5U102">size_j</span>)</span> - <span class="mxinfo" id="T4:U68"><span class="mxinfo" id="T4:U69">repmat(<span class="var type1" id="S20T6U106">area_j</span>, 1, <span class="var type1" id="S18T5U108">size_i</span>)</span>'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T11:U72"><span class="mxinfo" id="T5:U73">sum(<span class="mxinfo" id="T6:U74">find(<span class="mxinfo" id="T8:U75"><span class="mxinfo" id="T8:U76"><span class="var type1" id="S22T4U118">dif</span> == <span class="mxinfo" id="T5:U78">1</span></span> | <span class="mxinfo" id="T8:U79"><span class="var type1" id="S22T4U121">dif</span> == <span class="var type1" id="S13T5U122">x</span></span></span>)</span>)</span> ~= <span class="mxinfo" id="T5:U82">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo" id="T5:U83"><span class="mxinfo" id="T5:U84"><span class="var type1" id="S11T4U127">adjacency_graph</span>(<span class="var type1" id="S15T5U128">i</span>, <span class="var type1" id="S19T5U129">j</span>)</span> = <span class="mxinfo" id="T5:U88">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="comment">%% merge superpixels with similiar bspline</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T6:U89"><span class="var type1" id="S26T6U133">Dt</span> = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T25:U91"><span class="var type1" id="S27T25U138">errors</span> = <span class="mxinfo" id="T25:U93">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T6:U94"><span class="var type1" id="S28T6U143">pairs</span> = <span class="mxinfo" id="T6:U96">find(<span class="mxinfo" id="T8:U97"><span class="var type1" id="S11T4U147">adjacency_graph</span>~=<span class="mxinfo" id="T5:U99">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T11:U100"><span class="mxinfo" id="T5:U101">sum(<span class="var type1" id="S28T6U153">pairs</span>)</span> &gt; <span class="mxinfo" id="T5:U103">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo" id="T5:U104"><span class="var type1" id="S9T5U157">surface_amount</span> = <span class="mxinfo" id="T5:U106">size(<span class="var type1" id="S2T1U160">sp_set</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line">    <span class="mxinfo" id="T5:U108"><span class="var type1" id="S15T5U164">i</span> = <span class="mxinfo" id="T5:U110">mod(<span class="mxinfo" id="T5:U111"><span class="var type1" id="S28T6U168">pairs</span>(<span class="mxinfo" id="T5:U113">1</span>)</span>, <span class="var type1" id="S9T5U170">surface_amount</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo" id="T5:U115"><span class="var type1" id="S19T5U173">j</span> = <span class="mxinfo" id="T5:U117">ceil(<span class="mxinfo" id="T5:U118"><span class="mxinfo" id="T5:U119"><span class="var type1" id="S28T6U178">pairs</span>(<span class="mxinfo" id="T5:U121">1</span>)</span>/<span class="var type1" id="S9T5U180">surface_amount</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line">    <span class="mxinfo" id="T2:U123"><span class="var type1" id="S31T2U183">union_ij</span> = <span class="mxinfo" id="T2:U125">[<span class="mxinfo" id="T2:U126"><span class="mxinfo" id="T59:U127"><span class="var type1" id="S2T1U188">sp_set</span>(<span class="var type1" id="S15T5U189">i</span>)</span>.val</span>; <span class="mxinfo" id="T2:U130"><span class="mxinfo" id="T59:U131"><span class="var type1" id="S2T1U194">sp_set</span>(<span class="var type1" id="S19T5U195">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">    <span class="mxinfo" id="T2:U134"><span class="var type1" id="S32T2U199">ref_union</span> = <span class="mxinfo" id="T2:U136">[<span class="mxinfo" id="T2:U137"><span class="mxinfo" id="T59:U138"><span class="var type1" id="S4T1U204">ref_set</span>(<span class="var type1" id="S15T5U205">i</span>)</span>.val</span>; <span class="mxinfo" id="T2:U141"><span class="mxinfo" id="T59:U142"><span class="var type1" id="S4T1U210">ref_set</span>(<span class="var type1" id="S19T5U211">j</span>)</span>.val</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo" id="T50:U145"><span class="var type1" id="S33T50U215">control_p</span> = <span class="mxinfo" id="T50:U147"><span class="fcn" id="F351N3:B217">bspline_inv</span>(<span class="var type1" id="S31T2U218">union_ij</span>, <span class="var type1" id="S32T2U219">ref_union</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo" id="T27:U150"><span class="var type1" id="S35T27U222">bound1</span> = <span class="mxinfo" id="T27:U152">min(<span class="var type1" id="S31T2U225">union_ij</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T27:U154"><span class="var type1" id="S37T27U231">bound2</span> = <span class="mxinfo" id="T27:U156">min(<span class="mxinfo" id="T2:U157"><span class="mxinfo" id="T59:U158"><span class="var type1" id="S2T1U236">sp_set</span>(<span class="var type1" id="S15T5U237">i</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo" id="T27:U161"><span class="var type1" id="S38T27U244">bound3</span> = <span class="mxinfo" id="T27:U163">min(<span class="mxinfo" id="T2:U164"><span class="mxinfo" id="T59:U165"><span class="var type1" id="S2T1U249">sp_set</span>(<span class="var type1" id="S19T5U250">j</span>)</span>.val</span>, [], 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo" id="T5:U168"><span class="var type1" id="S18T5U257">size_i</span> = <span class="mxinfo" id="T5:U170">size(<span class="mxinfo" id="T2:U171"><span class="mxinfo" id="T59:U172"><span class="var type1" id="S2T1U262">sp_set</span>(<span class="var type1" id="S15T5U263">i</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T52:U175"><span class="var type1" id="S39T52U268">item</span> = <span class="mxinfo" id="T52:U177">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T4:U178"><span class="var type1" id="S33T50U273">control_p</span>(:,:,<span class="mxinfo" id="T5:U180">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T4:U181"><span class="var type1" id="S33T50U279">control_p</span>(:,:,<span class="mxinfo" id="T5:U183">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line">    <span class="mxinfo" id="T53:U184"><span class="var type1" id="S41T53U285">ref_it</span> = <span class="mxinfo" id="T53:U186">int32(<span class="mxinfo" id="T2:U187"><span class="fcn" id="F368N2:B289">bspline</span>(<span class="mxinfo" id="T2:U188"><span class="mxinfo" id="T59:U189"><span class="var type1" id="S2T1U292">sp_set</span>(<span class="var type1" id="S15T5U293">i</span>)</span>.val</span>, <span class="var type1" id="S39T52U295">item</span>, <span class="var type1" id="S35T27U296">bound1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T53:U194"><span class="var type1" id="S44T53U299">ref_i</span> = <span class="mxinfo" id="T53:U196">int32(<span class="mxinfo" id="T2:U197"><span class="fcn" id="F368N2:B303">bspline</span>(<span class="mxinfo" id="T2:U198"><span class="mxinfo" id="T59:U199"><span class="var type1" id="S2T1U306">sp_set</span>(<span class="var type1" id="S15T5U307">i</span>)</span>.val</span>, <span class="mxinfo" id="T52:U202"><span class="var type1" id="S3T3U310">bspline_set</span>(<span class="var type1" id="S15T5U311">i</span>)</span>, <span class="var type1" id="S37T27U312">bound2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo" id="T60:U206"><span class="mxinfo" id="T60:U207"><span class="var type1" id="S41T53U316">ref_it</span>(<span class="mxinfo" id="T54:U209"><span class="var type1" id="S41T53U318">ref_it</span>&lt;<span class="mxinfo" id="T5:U211">1</span></span>)</span>=<span class="mxinfo" id="T5:U212">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T60:U213"><span class="mxinfo" id="T60:U214"><span class="var type1" id="S41T53U324">ref_it</span>(<span class="mxinfo" id="T18:U216"><span class="mxinfo" id="T60:U217"><span class="var type1" id="S41T53U327">ref_it</span>(:, <span class="mxinfo" id="T5:U219">1</span>)</span>&gt;<span class="var type1" id="S13T5U330">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U332">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo" id="T60:U222"><span class="mxinfo" id="T60:U223"><span class="var type1" id="S41T53U336">ref_it</span>(<span class="mxinfo" id="T18:U225"><span class="mxinfo" id="T60:U226"><span class="var type1" id="S41T53U339">ref_it</span>(:, <span class="mxinfo" id="T5:U228">2</span>)</span>&gt;<span class="var type1" id="S14T5U342">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U344">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo" id="T60:U231"><span class="mxinfo" id="T60:U232"><span class="var type1" id="S44T53U348">ref_i</span>(<span class="mxinfo" id="T54:U234"><span class="var type1" id="S44T53U350">ref_i</span>&lt;<span class="mxinfo" id="T5:U236">1</span></span>)</span>=<span class="mxinfo" id="T5:U237">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo" id="T60:U238"><span class="mxinfo" id="T60:U239"><span class="var type1" id="S44T53U356">ref_i</span>(<span class="mxinfo" id="T18:U241"><span class="mxinfo" id="T60:U242"><span class="var type1" id="S44T53U359">ref_i</span>(:, <span class="mxinfo" id="T5:U244">1</span>)</span>&gt;<span class="var type1" id="S13T5U362">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U364">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo" id="T60:U247"><span class="mxinfo" id="T60:U248"><span class="var type1" id="S44T53U368">ref_i</span>(<span class="mxinfo" id="T18:U250"><span class="mxinfo" id="T60:U251"><span class="var type1" id="S44T53U371">ref_i</span>(:, <span class="mxinfo" id="T5:U253">2</span>)</span>&gt;<span class="var type1" id="S14T5U374">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U376">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">    <span class="mxinfo" id="T56:U256"><span class="var type1" id="S45T56U379">val_it</span> = <span class="mxinfo" id="T56:U258"><span class="fcn" id="F373N5:B381">getPixelsValue</span>(<span class="var type1" id="S7T55U382">Ref</span>, <span class="var type1" id="S41T53U383">ref_it</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo" id="T56:U261"><span class="var type1" id="S47T56U386">val_i</span> = <span class="mxinfo" id="T56:U263"><span class="fcn" id="F373N5:B388">getPixelsValue</span>(<span class="var type1" id="S7T55U389">Ref</span>, <span class="var type1" id="S44T53U390">ref_i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo" id="T5:U266"><span class="var type1" id="S21T5U393">size_j</span> = <span class="mxinfo" id="T5:U268">size(<span class="mxinfo" id="T2:U269"><span class="mxinfo" id="T59:U270"><span class="var type1" id="S2T1U398">sp_set</span>(<span class="var type1" id="S19T5U399">j</span>)</span>.val</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo" id="T53:U273"><span class="var type1" id="S48T53U404">ref_jt</span> = <span class="mxinfo" id="T53:U275">int32(<span class="mxinfo" id="T2:U276"><span class="fcn" id="F368N2:B408">bspline</span>(<span class="mxinfo" id="T2:U277"><span class="mxinfo" id="T59:U278"><span class="var type1" id="S2T1U411">sp_set</span>(<span class="var type1" id="S19T5U412">j</span>)</span>.val</span>, <span class="var type1" id="S39T52U414">item</span>, <span class="var type1" id="S35T27U415">bound1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo" id="T53:U283"><span class="var type1" id="S49T53U418">ref_j</span> = <span class="mxinfo" id="T53:U285">int32(<span class="mxinfo" id="T2:U286"><span class="fcn" id="F368N2:B422">bspline</span>(<span class="mxinfo" id="T2:U287"><span class="mxinfo" id="T59:U288"><span class="var type1" id="S2T1U425">sp_set</span>(<span class="var type1" id="S19T5U426">j</span>)</span>.val</span>, <span class="mxinfo" id="T52:U291"><span class="var type1" id="S3T3U429">bspline_set</span>(<span class="var type1" id="S19T5U430">j</span>)</span>, <span class="var type1" id="S38T27U431">bound3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line">    <span class="mxinfo" id="T60:U295"><span class="mxinfo" id="T60:U296"><span class="var type1" id="S48T53U435">ref_jt</span>(<span class="mxinfo" id="T54:U298"><span class="var type1" id="S48T53U437">ref_jt</span>&lt;<span class="mxinfo" id="T5:U300">1</span></span>)</span>=<span class="mxinfo" id="T5:U301">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo" id="T60:U302"><span class="mxinfo" id="T60:U303"><span class="var type1" id="S48T53U443">ref_jt</span>(<span class="mxinfo" id="T18:U305"><span class="mxinfo" id="T60:U306"><span class="var type1" id="S48T53U446">ref_jt</span>(:, <span class="mxinfo" id="T5:U308">1</span>)</span>&gt;<span class="var type1" id="S13T5U449">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U451">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line">    <span class="mxinfo" id="T60:U311"><span class="mxinfo" id="T60:U312"><span class="var type1" id="S48T53U455">ref_jt</span>(<span class="mxinfo" id="T18:U314"><span class="mxinfo" id="T60:U315"><span class="var type1" id="S48T53U458">ref_jt</span>(:, <span class="mxinfo" id="T5:U317">2</span>)</span>&gt;<span class="var type1" id="S14T5U461">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U463">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line">    <span class="mxinfo" id="T60:U320"><span class="mxinfo" id="T60:U321"><span class="var type1" id="S49T53U467">ref_j</span>(<span class="mxinfo" id="T54:U323"><span class="var type1" id="S49T53U469">ref_j</span>&lt;<span class="mxinfo" id="T5:U325">1</span></span>)</span>=<span class="mxinfo" id="T5:U326">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line">    <span class="mxinfo" id="T60:U327"><span class="mxinfo" id="T60:U328"><span class="var type1" id="S49T53U475">ref_j</span>(<span class="mxinfo" id="T18:U330"><span class="mxinfo" id="T60:U331"><span class="var type1" id="S49T53U478">ref_j</span>(:, <span class="mxinfo" id="T5:U333">1</span>)</span>&gt;<span class="var type1" id="S13T5U481">x</span></span>, 1)</span>=<span class="var type1" id="S13T5U483">x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line">    <span class="mxinfo" id="T60:U336"><span class="mxinfo" id="T60:U337"><span class="var type1" id="S49T53U487">ref_j</span>(<span class="mxinfo" id="T18:U339"><span class="mxinfo" id="T60:U340"><span class="var type1" id="S49T53U490">ref_j</span>(:, <span class="mxinfo" id="T5:U342">2</span>)</span>&gt;<span class="var type1" id="S14T5U493">y</span></span>, 2)</span>=<span class="var type1" id="S14T5U495">y</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line">    <span class="mxinfo" id="T56:U345"><span class="var type1" id="S50T56U498">val_jt</span> = <span class="mxinfo" id="T56:U347"><span class="fcn" id="F373N5:B500">getPixelsValue</span>(<span class="var type1" id="S7T55U501">Ref</span>, <span class="var type1" id="S48T53U502">ref_jt</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line">    <span class="mxinfo" id="T56:U350"><span class="var type1" id="S51T56U505">val_j</span> = <span class="mxinfo" id="T56:U352"><span class="fcn" id="F373N5:B507">getPixelsValue</span>(<span class="var type1" id="S7T55U508">Ref</span>, <span class="var type1" id="S49T53U509">ref_j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo" id="T5:U355"><span class="var type1" id="S52T5U512">D_sp1</span> = <span class="mxinfo" id="T5:U357">sum(<span class="mxinfo" id="T57:U358">sum(<span class="mxinfo" id="T56:U359">(<span class="mxinfo" id="T56:U360"><span class="var type1" id="S45T56U520">val_it</span>-<span class="var type1" id="S47T56U521">val_i</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line">    <span class="mxinfo" id="T5:U363"><span class="var type1" id="S53T5U527">D_sp2</span> = <span class="mxinfo" id="T5:U365">sum(<span class="mxinfo" id="T57:U366">sum(<span class="mxinfo" id="T56:U367">(<span class="mxinfo" id="T56:U368"><span class="var type1" id="S50T56U535">val_jt</span>-<span class="var type1" id="S51T56U536">val_j</span></span>).^2</span>, 1)</span>, 2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line">    <span class="mxinfo" id="T5:U371"><span class="var type1" id="S54T5U542">D_sp</span> = <span class="mxinfo" id="T5:U373">(<span class="mxinfo" id="T5:U374"><span class="var type1" id="S52T5U546">D_sp1</span>+<span class="var type1" id="S53T5U547">D_sp2</span></span>)/<span class="mxinfo" id="T5:U377">size(<span class="var type1" id="S31T2U550">union_ij</span>, 1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line">    <span class="mxinfo" id="T6:U379"><span class="var type1" id="S26T6U554">Dt</span> = <span class="mxinfo" id="T6:U381">[<span class="var type1" id="S26T6U557">Dt</span>; <span class="var type1" id="S54T5U559">D_sp</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line">    <span class="mxinfo" id="T5:U384"><span class="mxinfo" id="T5:U385"><span class="var type1" id="S11T4U563">adjacency_graph</span>(<span class="var type1" id="S15T5U564">i</span>, <span class="var type1" id="S19T5U565">j</span>)</span> = <span class="mxinfo" id="T5:U389">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T11:U390"><span class="var type1" id="S54T5U570">D_sp</span> &lt; <span class="mxinfo" id="T5:U392">10</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo" id="T42:U393"><span class="mxinfo" id="T42:U394"><span class="var type1" id="S11T4U575">adjacency_graph</span>(<span class="var type1" id="S15T5U576">i</span>, <span class="mxinfo" id="T11:U397"><span class="var type1" id="S15T5U578">i</span>:<span class="var type1" id="S19T5U579">j</span></span>)</span> = <span class="mxinfo" id="T42:U400"><span class="mxinfo" id="T42:U401"><span class="var type1" id="S11T4U582">adjacency_graph</span>(<span class="var type1" id="S15T5U583">i</span>, <span class="mxinfo" id="T11:U404"><span class="var type1" id="S15T5U585">i</span>:<span class="var type1" id="S19T5U586">j</span></span>)</span> + <span class="mxinfo" id="T42:U407"><span class="mxinfo" id="T6:U408"><span class="var type1" id="S11T4U589">adjacency_graph</span>(<span class="mxinfo" id="T11:U410"><span class="var type1" id="S15T5U591">i</span>:<span class="var type1" id="S19T5U592">j</span></span>, <span class="var type1" id="S19T5U593">j</span>)</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line">        <span class="mxinfo" id="T6:U414"><span class="mxinfo" id="T6:U415"><span class="var type1" id="S11T4U597">adjacency_graph</span>(<span class="mxinfo" id="T11:U417"><span class="mxinfo" id="T5:U418">1</span>:<span class="var type1" id="S15T5U600">i</span></span>, <span class="var type1" id="S15T5U601">i</span>)</span> = <span class="mxinfo" id="T6:U421"><span class="mxinfo" id="T6:U422"><span class="var type1" id="S11T4U604">adjacency_graph</span>(<span class="mxinfo" id="T11:U424"><span class="mxinfo" id="T5:U425">1</span>:<span class="var type1" id="S15T5U607">i</span></span>, <span class="var type1" id="S15T5U608">i</span>)</span> + <span class="mxinfo" id="T6:U428"><span class="var type1" id="S11T4U610">adjacency_graph</span>(<span class="mxinfo" id="T11:U430"><span class="mxinfo" id="T5:U431">1</span>:<span class="var type1" id="S15T5U613">i</span></span>, <span class="var type1" id="S19T5U614">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line">        <span class="mxinfo" id="T42:U434"><span class="mxinfo" id="T42:U435"><span class="var type1" id="S11T4U618">adjacency_graph</span>(<span class="var type1" id="S15T5U619">i</span>, <span class="mxinfo" id="T11:U438"><span class="var type1" id="S19T5U621">j</span>:<span class="mxinfo" id="T5:U440">end</span></span>)</span> = <span class="mxinfo" id="T42:U441"><span class="mxinfo" id="T42:U442"><span class="var type1" id="S11T4U626">adjacency_graph</span>(<span class="var type1" id="S15T5U627">i</span>, <span class="mxinfo" id="T11:U445"><span class="var type1" id="S19T5U629">j</span>:<span class="mxinfo" id="T5:U447">end</span></span>)</span> + <span class="mxinfo" id="T42:U448"><span class="var type1" id="S11T4U633">adjacency_graph</span>(<span class="var type1" id="S19T5U634">j</span>, <span class="mxinfo" id="T11:U451"><span class="var type1" id="S19T5U636">j</span>:<span class="mxinfo" id="T5:U453">end</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78">78</a></span><span class="line">        <span class="mxinfo" id="T4:U454"><span class="var type1" id="S11T4U642">adjacency_graph</span>(<span class="var type1" id="S19T5U643">j</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79">79</a></span><span class="line">        <span class="mxinfo" id="T4:U457"><span class="var type1" id="S11T4U650">adjacency_graph</span>(:, <span class="var type1" id="S19T5U652">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80">80</a></span><span class="line">        <span class="mxinfo" id="T2:U460"><span class="mxinfo" id="T2:U461"><span class="mxinfo" id="T59:U462"><span class="var type1" id="S2T1U659">sp_set</span>(<span class="var type1" id="S15T5U660">i</span>)</span>.val</span> = <span class="var type1" id="S31T2U662">union_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81">81</a></span><span class="line">        <span class="mxinfo" id="T1:U466"><span class="var type1" id="S2T1U666">sp_set</span>(<span class="var type1" id="S19T5U667">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82">82</a></span><span class="line">        <span class="mxinfo" id="T2:U469"><span class="mxinfo" id="T2:U470"><span class="mxinfo" id="T59:U471"><span class="var type1" id="S4T1U674">ref_set</span>(<span class="var type1" id="S15T5U675">i</span>)</span>.val</span> = <span class="var type1" id="S32T2U677">ref_union</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83">83</a></span><span class="line">        <span class="mxinfo" id="T1:U475"><span class="var type1" id="S4T1U681">ref_set</span>(<span class="var type1" id="S19T5U682">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84">84</a></span><span class="line">        <span class="mxinfo" id="T52:U478"><span class="var type1" id="S39T52U687">item</span> = <span class="mxinfo" id="T52:U480">struct(<span class="string">'x'</span>, <span class="mxinfo" id="T4:U481"><span class="var type1" id="S33T50U692">control_p</span>(:,:,<span class="mxinfo" id="T5:U483">1</span>)</span>, <span class="string">'y'</span>, <span class="mxinfo" id="T4:U484"><span class="var type1" id="S33T50U698">control_p</span>(:,:,<span class="mxinfo" id="T5:U486">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85">85</a></span><span class="line">        <span class="mxinfo" id="T52:U487"><span class="mxinfo" id="T52:U488"><span class="var type1" id="S3T3U705">bspline_set</span>(<span class="var type1" id="S15T5U706">i</span>)</span> = <span class="var type1" id="S39T52U707">item</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86">86</a></span><span class="line">        <span class="mxinfo" id="T3:U492"><span class="var type1" id="S3T3U711">bspline_set</span>(<span class="var type1" id="S19T5U712">j</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87">87</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88">88</a></span><span class="line">    <span class="mxinfo" id="T6:U495"><span class="var type1" id="S28T6U717">pairs</span> = <span class="mxinfo" id="T6:U497">find(<span class="mxinfo" id="T8:U498"><span class="var type1" id="S11T4U721">adjacency_graph</span>~=<span class="mxinfo" id="T5:U500">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89">89</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90">90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91">91</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
